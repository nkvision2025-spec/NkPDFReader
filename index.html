<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Voice Reader Pro - Ultimate Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #050505; color: #fff; margin: 0; overflow: hidden; }
        .secure-input { -webkit-text-security: disc; }
        .glass { background: rgba(10, 10, 10, 0.8); backdrop-filter: blur(20px); border-bottom: 1px solid rgba(255,255,255,0.05); }
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
        .pdf-scroll-area { overflow: auto; display: flex; justify-content: center; align-items: flex-start; background: #0a0a0a; flex-grow: 1; }
        canvas { transition: transform 0.2s ease; transform-origin: top center; box-shadow: 0 0 50px rgba(0,0,0,0.5); }
        .panel-header { font-size: 9px; font-weight: 900; color: #444; text-transform: uppercase; letter-spacing: 0.2em; border-bottom: 1px solid #111; padding-bottom: 8px; margin-bottom: 12px; }
    </style>
</head>
<body>

    <!-- LOGIN PAGE -->
    <div id="loginPage" class="fixed inset-0 z-[9999] bg-black flex items-center justify-center p-6">
        <div class="w-full max-w-md bg-zinc-950 border border-zinc-900 rounded-[3rem] p-10 shadow-2xl">
            <div class="text-center mb-8">
                <div class="w-20 h-20 bg-blue-600 rounded-3xl flex items-center justify-center mx-auto mb-4 shadow-lg shadow-blue-600/20">
                    <i class="fas fa-robot text-3xl text-white"></i>
                </div>
                <h1 class="text-2xl font-black italic tracking-tighter">VOICE AI ULTIMATE</h1>
                <p class="text-zinc-600 text-[9px] font-black tracking-[0.4em] uppercase mt-2">Biometric Verification Required</p>
            </div>
            <div class="space-y-4">
                <input id="userId" type="text" placeholder="Terminal ID" class="w-full bg-black border border-zinc-800 p-4 rounded-2xl outline-none focus:border-blue-600 transition-all text-sm">
                <input id="userPass" type="text" placeholder="Access Key" class="secure-input w-full bg-black border border-zinc-800 p-4 rounded-2xl outline-none focus:border-blue-600 transition-all text-sm">
                <button onclick="handleLogin()" class="w-full bg-blue-600 hover:bg-blue-500 py-4 rounded-2xl font-black text-xs uppercase tracking-widest transition-all active:scale-95">Verify & Initialize</button>
            </div>
        </div>
    </div>

    <!-- MAIN APP INTERFACE -->
    <div id="appPage" class="hidden h-screen flex flex-col">
        <!-- Ultra Thin Header -->
        <header class="h-14 border-b border-zinc-900 bg-black flex items-center justify-between px-6 z-50">
            <div class="flex items-center gap-4">
                <i class="fas fa-brain text-blue-600"></i>
                <h2 id="headerTitle" class="text-[9px] font-black uppercase tracking-[0.3em] text-zinc-500">Core Terminal</h2>
            </div>
            <div class="flex items-center gap-6">
                <!-- AI CONFIG BUTTONS -->
                <div class="flex gap-2 mr-4 border-r border-zinc-800 pr-4">
                    <button onclick="toggleModal('aiSettings')" class="text-[8px] font-black text-zinc-500 hover:text-blue-500 uppercase">AI Config</button>
                    <button onclick="toggleModal('userSettings')" class="text-[8px] font-black text-zinc-500 hover:text-blue-500 uppercase">Manage Users</button>
                </div>
                <div class="flex items-center gap-3">
                    <div class="text-right">
                        <p class="text-[9px] font-black uppercase" id="displayUserName">Administrator</p>
                        <p class="text-[7px] font-bold text-green-500 uppercase">Mode: Online</p>
                    </div>
                    <div class="relative group">
                        <img id="userPhoto" src="https://api.dicebear.com/7.x/avataaars/svg?seed=admin" class="w-8 h-8 rounded-lg border border-zinc-800 cursor-pointer" onclick="triggerPhotoUpload()">
                        <input type="file" id="photoInput" class="hidden" onchange="updateUserPhoto(event)">
                    </div>
                </div>
            </div>
        </header>

        <div class="flex-1 flex overflow-hidden">
            <!-- Mini Sidebar -->
            <aside class="w-16 border-r border-zinc-900 bg-zinc-950 flex flex-col items-center py-6 gap-6">
                <button onclick="showView('dashboard')" class="text-blue-500"><i class="fas fa-layer-group"></i></button>
                <button onclick="showView('reader')" class="text-zinc-600 hover:text-blue-500"><i class="fas fa-book-open"></i></button>
                <div class="mt-auto">
                    <button onclick="location.reload()" class="text-zinc-800 hover:text-red-500"><i class="fas fa-power-off"></i></button>
                </div>
            </aside>

            <!-- Content Area -->
            <main class="flex-1 flex flex-col relative">
                
                <!-- DASHBOARD VIEW -->
                <div id="dashboardView" class="flex-1 overflow-auto p-8">
                    <div class="panel-header">Document Matrix</div>
                    <div id="pdfGrid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-6">
                        <label class="aspect-square bg-zinc-900/30 border border-dashed border-zinc-800 rounded-3xl flex flex-col items-center justify-center hover:border-blue-600 cursor-pointer transition-all group">
                            <input type="file" accept=".pdf" class="hidden" onchange="uploadPDF(event)">
                            <i class="fas fa-cloud-upload-alt text-zinc-700 group-hover:text-blue-500"></i>
                            <span class="text-[8px] font-black uppercase mt-3 text-zinc-700">Inject PDF</span>
                        </label>
                    </div>
                </div>

                <!-- READER VIEW (Maximized) -->
                <div id="readerView" class="hidden flex-1 flex flex-col overflow-hidden">
                    <!-- Ultra Thin Control Bar -->
                    <div class="h-10 bg-zinc-900/50 border-b border-zinc-800 flex items-center justify-between px-4">
                        <div class="flex items-center gap-4">
                            <button onclick="changePage(-1)" class="text-zinc-400 hover:text-white"><i class="fas fa-caret-left"></i></button>
                            <span id="pageNumber" class="text-[9px] font-black text-blue-500 tracking-tighter w-12 text-center">1/1</span>
                            <button onclick="changePage(1)" class="text-zinc-400 hover:text-white"><i class="fas fa-caret-right"></i></button>
                            <div class="h-4 w-px bg-zinc-800 mx-2"></div>
                            <button onclick="updateZoom(-0.1)" class="text-zinc-500"><i class="fas fa-minus text-[10px]"></i></button>
                            <span id="zoomLevel" class="text-[8px] font-black w-8 text-center">100%</span>
                            <button onclick="updateZoom(0.1)" class="text-zinc-500"><i class="fas fa-plus text-[10px]"></i></button>
                        </div>
                        
                        <!-- PLAY BAR (Thin) -->
                        <div class="flex items-center gap-6">
                            <div class="flex items-center gap-3">
                                <i class="fas fa-volume-up text-zinc-600 text-[10px]"></i>
                                <select id="voiceSpeed" class="bg-transparent text-[8px] font-black uppercase outline-none text-zinc-400">
                                    <option value="0.8">0.8x</option>
                                    <option value="1.0" selected>1.0x</option>
                                    <option value="1.5">1.5x</option>
                                </select>
                                <select id="voiceGender" class="bg-transparent text-[8px] font-black uppercase outline-none text-zinc-400">
                                    <option value="male">Male</option>
                                    <option value="female" selected>Female</option>
                                </select>
                            </div>
                            <button onclick="handleVoice()" id="voiceBtn" class="bg-blue-600 px-6 h-7 rounded-full text-[9px] font-black uppercase tracking-widest hover:bg-blue-500 shadow-lg shadow-blue-600/10">
                                <i class="fas fa-play mr-2"></i> Play Voice
                            </button>
                        </div>

                        <button onclick="closeReader()" class="text-zinc-600 hover:text-red-500"><i class="fas fa-times"></i></button>
                    </div>

                    <!-- Main Reader Content -->
                    <div class="flex-1 flex overflow-hidden">
                        <!-- PDF Scroll Area (Enlarged) -->
                        <div class="flex-1 pdf-scroll-area custom-scrollbar" id="pdfContainer">
                            <canvas id="pdfCanvas" class="my-8"></canvas>
                        </div>
                        <!-- Transcript Panel (Wider & Dynamic) -->
                        <div class="w-80 bg-black border-l border-zinc-900 flex flex-col">
                            <div class="p-4 border-b border-zinc-900 flex justify-between items-center">
                                <span class="text-[9px] font-black text-blue-500 tracking-widest uppercase">Live Transcript</span>
                                <div class="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"></div>
                            </div>
                            <div id="transcript" class="flex-1 p-6 overflow-auto text-xs text-zinc-500 leading-relaxed italic custom-scrollbar">
                                Initializing neural link...
                            </div>
                            <div class="p-4 bg-zinc-950 border-t border-zinc-900">
                                <p class="text-[7px] font-black text-zinc-700 uppercase mb-2">Target Language</p>
                                <select id="voiceLang" class="w-full bg-black border border-zinc-800 rounded-lg p-2 text-[8px] font-black uppercase text-zinc-500">
                                    <option value="hi-IN">Hindi (Indian)</option>
                                    <option value="en-US">English (US)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- MODAL: AI SETTINGS -->
    <div id="aiSettings" class="hidden fixed inset-0 z-[10000] bg-black/90 backdrop-blur-md flex items-center justify-center p-6">
        <div class="w-full max-w-lg bg-zinc-950 border border-zinc-900 rounded-[2.5rem] p-10">
            <div class="panel-header">AI Neural Configuration</div>
            <div class="space-y-6">
                <div>
                    <label class="block text-[8px] font-black text-zinc-500 uppercase mb-2">Gemini API Key</label>
                    <input type="password" id="apiKey" class="w-full bg-black border border-zinc-800 p-3 rounded-xl text-xs text-blue-500" placeholder="Enter Key...">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-[8px] font-black text-zinc-500 uppercase mb-2">AI Model</label>
                        <select id="aiModel" class="w-full bg-black border border-zinc-800 p-3 rounded-xl text-xs">
                            <option value="flash">Gemini 2.5 Flash (Fast)</option>
                            <option value="pro">Gemini 2.5 Pro (Precise)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-[8px] font-black text-zinc-500 uppercase mb-2">Access Mode</label>
                        <select id="accessMode" class="w-full bg-black border border-zinc-800 p-3 rounded-xl text-xs">
                            <option value="online">Cloud Online</option>
                            <option value="offline">Offline Cache</option>
                        </select>
                    </div>
                </div>
                <button onclick="toggleModal('aiSettings')" class="w-full bg-zinc-900 border border-zinc-800 py-3 rounded-xl text-[10px] font-black uppercase">Save Configuration</button>
            </div>
        </div>
    </div>

    <!-- MODAL: USER MANAGEMENT -->
    <div id="userSettings" class="hidden fixed inset-0 z-[10000] bg-black/90 backdrop-blur-md flex items-center justify-center p-6">
        <div class="w-full max-w-2xl bg-zinc-950 border border-zinc-900 rounded-[2.5rem] p-10 flex flex-col max-h-[80vh]">
            <div class="panel-header">User Access Control</div>
            <div class="flex-1 overflow-auto custom-scrollbar mb-6">
                <table class="w-full text-left">
                    <thead class="text-[8px] text-zinc-700 uppercase">
                        <tr><th class="pb-4">User</th><th class="pb-4">Role</th><th class="pb-4">Assigned PDF</th><th class="pb-4">Action</th></tr>
                    </thead>
                    <tbody id="userTable" class="text-[10px] font-bold">
                        <!-- Users here -->
                    </tbody>
                </table>
            </div>
            <div class="grid grid-cols-3 gap-2 p-4 bg-zinc-900 rounded-2xl">
                <input id="newUserId" placeholder="New ID" class="bg-black border-none p-2 rounded-lg text-xs">
                <input id="newUserPass" placeholder="Pass" class="bg-black border-none p-2 rounded-lg text-xs">
                <button onclick="addUser()" class="bg-blue-600 rounded-lg text-[9px] font-black uppercase">Add User</button>
            </div>
            <button onclick="toggleModal('userSettings')" class="mt-4 text-[9px] font-black text-zinc-600 uppercase">Close Terminal</button>
        </div>
    </div>

    <script>
        const pdfjsLib = window['pdfjs-dist/build/pdf'];
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

        let state = {
            pdfs: JSON.parse(localStorage.getItem('v_ult_pdfs') || '[]'),
            users: JSON.parse(localStorage.getItem('v_ult_users') || '[{"id":"admin","pass":"admin","role":"Admin","photo":"https://api.dicebear.com/7.x/avataaars/svg?seed=admin"}]'),
            currentUser: null,
            pdfInstance: null,
            pageNum: 1,
            zoom: 1.0,
            isReading: false
        };

        const synth = window.speechSynthesis;

        function handleLogin() {
            const u = document.getElementById('userId').value;
            const p = document.getElementById('userPass').value;
            const user = state.users.find(x => x.id === u && x.pass === p);
            if(user) {
                state.currentUser = user;
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('appPage').style.display = 'flex';
                document.getElementById('displayUserName').innerText = user.id;
                document.getElementById('userPhoto').src = user.photo;
                renderLibrary();
                renderUserTable();
            } else {
                alert("ACCESS DENIED: Credentials Invalid");
            }
        }

        function toggleModal(id) {
            const m = document.getElementById(id);
            m.classList.toggle('hidden');
        }

        function renderLibrary() {
            const grid = document.getElementById('pdfGrid');
            const upload = grid.firstElementChild;
            grid.innerHTML = ''; grid.appendChild(upload);
            state.pdfs.forEach(pdf => {
                const card = document.createElement('div');
                card.className = "aspect-square bg-zinc-900/50 border border-zinc-800 rounded-3xl p-5 flex flex-col justify-between hover:border-blue-600 cursor-pointer relative group";
                card.onclick = () => openReader(pdf);
                card.innerHTML = `
                    <div class="text-red-500 opacity-50"><i class="fas fa-file-pdf text-xl"></i></div>
                    <div class="text-[9px] font-black uppercase truncate">${pdf.title}</div>
                    <button onclick="event.stopPropagation(); deletePDF(${pdf.id})" class="absolute top-4 right-4 text-zinc-800 hover:text-red-500 opacity-0 group-hover:opacity-100"><i class="fas fa-trash-alt"></i></button>
                `;
                grid.appendChild(card);
            });
        }

        function uploadPDF(e) {
            const file = e.target.files[0];
            if(!file) return;
            const r = new FileReader();
            r.onload = () => {
                state.pdfs.push({ id: Date.now(), title: file.name, url: r.result });
                localStorage.setItem('v_ult_pdfs', JSON.stringify(state.pdfs));
                renderLibrary();
            };
            r.readAsDataURL(file);
        }

        function deletePDF(id) {
            state.pdfs = state.pdfs.filter(p => p.id !== id);
            localStorage.setItem('v_ult_pdfs', JSON.stringify(state.pdfs));
            renderLibrary();
        }

        async function openReader(pdf) {
            state.pageNum = 1;
            state.zoom = 1.0;
            showView('reader');
            const loading = pdfjsLib.getDocument(pdf.url);
            state.pdfInstance = await loading.promise;
            renderPage();
        }

        async function renderPage() {
            const page = await state.pdfInstance.getPage(state.pageNum);
            const viewport = page.getViewport({ scale: 1.5 });
            const canvas = document.getElementById('pdfCanvas');
            const ctx = canvas.getContext('2d');
            canvas.height = viewport.height;
            canvas.width = viewport.width;
            canvas.style.transform = `scale(${state.zoom})`;
            
            await page.render({ canvasContext: ctx, viewport }).promise;
            document.getElementById('pageNumber').innerText = `${state.pageNum}/${state.pdfInstance.numPages}`;
            document.getElementById('zoomLevel').innerText = `${Math.round(state.zoom*100)}%`;
            
            const content = await page.getTextContent();
            const txt = content.items.map(i => i.str).join(' ');
            document.getElementById('transcript').innerText = txt || "No text detected.";
        }

        function updateZoom(v) {
            state.zoom = Math.max(0.2, Math.min(3, state.zoom + v));
            document.getElementById('pdfCanvas').style.transform = `scale(${state.zoom})`;
            document.getElementById('zoomLevel').innerText = `${Math.round(state.zoom*100)}%`;
        }

        function changePage(dir) {
            const n = state.pageNum + dir;
            if(n > 0 && n <= state.pdfInstance.numPages) {
                state.pageNum = n;
                if(state.isReading) handleVoice();
                renderPage();
            }
        }

        function handleVoice() {
            const btn = document.getElementById('voiceBtn');
            if(state.isReading) {
                synth.cancel();
                state.isReading = false;
                btn.innerHTML = `<i class="fas fa-play mr-2"></i> Play Voice`;
            } else {
                const txt = document.getElementById('transcript').innerText;
                const ut = new SpeechSynthesisUtterance(txt);
                ut.lang = document.getElementById('voiceLang').value;
                ut.rate = parseFloat(document.getElementById('voiceSpeed').value);
                
                // Gender logic (fallback to available voices)
                const voices = synth.getVoices();
                const gender = document.getElementById('voiceGender').value;
                const targetVoice = voices.find(v => (gender === 'female' ? v.name.includes('Female') || v.name.includes('Google US English') : v.name.includes('Male')));
                if(targetVoice) ut.voice = targetVoice;

                ut.onend = () => { state.isReading = false; btn.innerHTML = `<i class="fas fa-play mr-2"></i> Play Voice`; };
                synth.speak(ut);
                state.isReading = true;
                btn.innerHTML = `<i class="fas fa-stop mr-2"></i> Stop Voice`;
            }
        }

        function showView(v) {
            document.getElementById('dashboardView').classList.toggle('hidden', v !== 'dashboard');
            document.getElementById('readerView').classList.toggle('hidden', v !== 'reader');
            document.getElementById('headerTitle').innerText = v === 'reader' ? 'Reader Console' : 'Storage Terminal';
        }

        function closeReader() {
            synth.cancel(); state.isReading = false; showView('dashboard');
        }

        // USER MANAGEMENT
        function renderUserTable() {
            const tb = document.getElementById('userTable');
            tb.innerHTML = '';
            state.users.forEach(u => {
                const tr = document.createElement('tr');
                tr.className = "border-b border-zinc-900";
                tr.innerHTML = `
                    <td class="py-4 flex items-center gap-2">
                        <img src="${u.photo}" class="w-6 h-6 rounded-md">
                        <span>${u.id}</span>
                    </td>
                    <td class="text-zinc-600">${u.role}</td>
                    <td class="text-blue-500">Auto_Sync</td>
                    <td>
                        ${u.id !== 'admin' ? `<button onclick="removeUser('${u.id}')" class="text-red-500"><i class="fas fa-user-minus"></i></button>` : '---'}
                    </td>
                `;
                tb.appendChild(tr);
            });
        }

        function addUser() {
            const id = document.getElementById('newUserId').value;
            const pass = document.getElementById('newUserPass').value;
            if(!id || !pass) return;
            state.users.push({ id, pass, role: "User", photo: `https://api.dicebear.com/7.x/avataaars/svg?seed=${id}` });
            localStorage.setItem('v_ult_users', JSON.stringify(state.users));
            renderUserTable();
        }

        function removeUser(id) {
            state.users = state.users.filter(u => u.id !== id);
            localStorage.setItem('v_ult_users', JSON.stringify(state.users));
            renderUserTable();
        }

        function triggerPhotoUpload() { document.getElementById('photoInput').click(); }
        function updateUserPhoto(e) {
            const f = e.target.files[0];
            const reader = new FileReader();
            reader.onload = () => {
                state.currentUser.photo = reader.result;
                document.getElementById('userPhoto').src = reader.result;
                state.users = state.users.map(u => u.id === state.currentUser.id ? state.currentUser : u);
                localStorage.setItem('v_ult_users', JSON.stringify(state.users));
            };
            reader.readAsDataURL(f);
        }
    </script>
</body>
</html>